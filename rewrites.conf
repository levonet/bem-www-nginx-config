   
    rewrite ^/method/$ /pages-desktop/bem-method-index-$lang/bem-method-index-$lang.html last;
    rewrite ^/method/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/bem-method-index-$lang/_bem-method-index-$lang.$1$2 last;

    rewrite ^/method/([\w-]+)/$ /pages-desktop/bem-method-$1-$lang/bem-method-$1-$lang.html last;
    rewrite ^/method/([\w-]+)/_([\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/bem-method-$1-$lang/_$2.$3$4 last;
    rewrite ^/method/([\w-]+)/images/(.*)$ /content/bem-method/$1/images/$2 last;

    rewrite ^/tools/$ /pages-desktop/tools-index-$lang/tools-index-$lang.html last;
    rewrite ^/tools/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/tools-index-$lang/_tools-index-$lang.$1$2 last;

    rewrite ^/tools/bem/$ /pages-desktop/bem-tools-index-$lang/bem-tools-index-$lang.html last;
    rewrite ^/tools/bem/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/bem-tools-index-$lang/_bem-tools-index-$lang.$1$2 last;
    rewrite ^/tools/bem/([\w-]+)/$ /pages-desktop/bem-tools-$1-$lang/bem-tools-$1-$lang.html last;
    rewrite ^/tools/bem/([\w-]+)/_([\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/bem-tools-$1-$lang/_$2.$3$4 last;
    rewrite ^/tools/bem/([\w-]+)/images/(.*)$ /content/bem-tools/$1/images/$2 last;

    rewrite ^/tools/csso/$ /pages-desktop/csso-index-$lang/csso-index-$lang.html last;
    rewrite ^/tools/csso/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/csso-index-$lang/_csso-index-$lang.$1$2 last;
    rewrite ^/tools/csso/([\w-]+)/$ /pages-desktop/csso-$1-$lang/csso-$1-$lang.html last;
    rewrite ^/tools/csso/([\w-]+)/_([\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/csso-$1-$lang/_$2.$3$4 last;
    rewrite ^/tools/csso/([\w-]+)/images/(.*)$ /content/csso/$1/images/$2 last;

    rewrite ^/tools/borschik/$ /pages-desktop/borschik-index-$lang/borschik-index-$lang.html last;
    rewrite ^/tools/borschik/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/borschik-index-$lang/_borschik-index-$lang.$1$2 last;

    rewrite ^/tools/borschik-server/$ /pages-desktop/borschik-server-borschik-server-$lang/borschik-server-borschik-server-$lang.html last;
    rewrite ^/tools/borschik-server/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/borschik-server-borschik-server-$lang/_borschik-server-borschik-server-$lang.$1$2 last;

    # blog

    rewrite ^/blog/$ /pages-desktop/blog-bemup-yac2013-$lang/blog-bemup-yac2013-$lang.html last;
    rewrite ^/blog/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/blog-bemup-yac2013-$lang/_blog-bemup-yac2013-$lang.$1$2 last;

    rewrite ^/blog/2013/02/bem-goes-to-india/$ /pages-desktop/blog-2013-02-bem-goes-to-india-$lang/blog-2013-02-bem-goes-to-india-$lang.html last;
    rewrite ^/blog/2013/02/bem-goes-to-india/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/blog-2013-02-bem-goes-to-india-$lang/_blog-2013-02-bem-goes-to-india-$lang.$1$2 last;

    rewrite ^/blog/2013/02/maintainable-frontend-dev-with-bem/$ /pages-desktop/blog-2013-02-maintainable-frontend-dev-with-bem-$lang/blog-2013-02-maintainable-frontend-dev-with-bem-$lang.html last;
    rewrite ^/blog/2013/02/maintainable-frontend-dev-with-bem/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/blog-2013-02-maintainable-frontend-dev-with-bem-$lang/_blog-2013-02-maintainable-frontend-dev-with-bem-$lang.$1$2 last;

    rewrite ^/blog/2013/07/anygrid-bem-notations/$ /pages-desktop/blog-anygrid-bem-notations-$lang/blog-anygrid-bem-notations-$lang.html last;
    rewrite ^/blog/2013/07/anygrid-bem-notations/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/blog-anygrid-bem-notations-$lang/blog-anygrid-bem-notations-$lang.$1$2 last;

    rewrite ^/blog/2013/07/bem-tools-0-5-33/$ /pages-desktop/blog-bem-tools-0-5-33-$lang/blog-bem-tools-0-5-33-$lang.html last;
    rewrite ^/blog/2013/07/bem-tools-0-5-33/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/blog-bem-tools-0-5-33-$lang/blog-bem-tools-0-5-33-$lang.$1$2 last;

    rewrite ^/blog/2013/07/bem-tools-0-6-4/$ /pages-desktop/blog-bem-tools-0-6-4-$lang/blog-bem-tools-0-6-4-$lang.html last;
    rewrite ^/blog/2013/07/bem-tools-0-6-4/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/blog-bem-tools-0-6-4-$lang/blog-bem-tools-0-6-4-$lang.$1$2 last;

    rewrite ^/blog/2013/07/bem-cli/$ /pages-desktop/blog-bem-cli-$lang/blog-bem-cli-$lang.html last;
    rewrite ^/blog/2013/07/bem-cli/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/blog-bem-cli-$lang/blog-bem-cli-$lang.$1$2 last;

    rewrite ^/blog/2013/07/bemup/$ /pages-desktop/blog-bemup-$lang/blog-bemup-$lang.html last;
    rewrite ^/blog/2013/07/bemup/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/blog-bemup-$lang/blog-bemup-$lang.$1$2 last;

    rewrite ^/blog/2013/08/bem-components/$ /pages-desktop/blog-bem-components-$lang/blog-bem-components-$lang.html last;
    rewrite ^/blog/2013/08/bem-components/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/blog-bem-components-$lang/blog-bem-components-$lang.$1$2 last;

    rewrite ^/blog/2013/08/bemup-promo/$ /pages-desktop/blog-bemup-promo-$lang/blog-bemup-promo-$lang.html last;
    rewrite ^/blog/2013/08/bemup-promo/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/blog-bemup-promo-$lang/blog-bemup-promo-$lang.$1$2 last;

    rewrite ^/blog/2013/08/bemup-talks/$ /pages-desktop/blog-bemup-talks-$lang/blog-bemup-talks-$lang.html last;
    rewrite ^/blog/2013/08/bemup-talks/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/blog-bemup-talks-$lang/blog-bemup-talks-$lang.$1$2 last;

    rewrite ^/blog/2013/09/bemup-yac2013/$ /pages-desktop/blog-bemup-yac2013-$lang/blog-bemup-yac2013-$lang.html last;
    rewrite ^/blog/2013/09/bemup-yac2013/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/blog-bemup-yac2013-$lang/blog-bemup-yac2013-$lang.$1$2 last;

    rewrite ^/pages/acknowledgement/$ /pages-desktop/pages-acknowledgement-$lang/pages-acknowledgement-$lang.html last;
    rewrite ^/pages/acknowledgement/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/pages-acknowledgement-$lang/pages-acknowledgement-$lang.$1$2 last;

    #end blog

    rewrite ^/articles/$ /pages-desktop/articles-index-$lang/articles-index-$lang.html last;
    rewrite ^/articles/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/articles-index-$lang/_articles-index-$lang.$1$2 last;

    rewrite ^/articles/start-with-project-stub/$ /pages-desktop/articles-start-with-project-stub-$lang/articles-start-with-project-stub-$lang.html last;
    rewrite ^/articles/start-with-project-stub/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/articles-start-with-project-stub-$lang/_articles-start-with-project-stub-$lang.$1$2 last;

    rewrite ^/articles/yandex-frontend-dev/$ /pages-desktop/articles-yandex-frontend-dev-$lang/articles-yandex-frontend-dev-$lang.html last;
    rewrite ^/articles/yandex-frontend-dev/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/articles-yandex-frontend-dev-$lang/_articles-yandex-frontend-dev-$lang.$1$2 last;

    rewrite ^/articles/borschik/$ /pages-desktop/articles-borschik-$lang/articles-borschik-$lang.html last;
    rewrite ^/articles/borschik/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/articles-borschik-$lang/_articles-borschik-$lang.$1$2 last;

    rewrite ^/articles/bem-js-main-terms/$ /pages-desktop/articles-bem-js-main-terms-$lang/articles-bem-js-main-terms-$lang.html last;
    rewrite ^/articles/bem-js-main-terms/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/articles-bem-js-main-terms-$lang/_articles-bem-js-main-terms-$lang.$1$2 last;

    rewrite ^/articles/bemhtml-intro/$ /pages-desktop/bem-core-intro-$lang/bem-core-intro-$lang.html last;
    rewrite ^/articles/bemhtml-intro/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/bem-core-intro-$lang/_bem-core-intro-$lang.$1$2 last;
    rewrite ^/articles/bemhtml-reference/$ /pages-desktop/bem-core-reference-$lang/bem-core-reference-$lang.html last;
    rewrite ^/articles/bemhtml-reference/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/bem-core-reference-$lang/_bem-core-reference-$lang.$1$2 last;
    rewrite ^/articles/bemhtml-rationale/$ /pages-desktop/bem-core-rationale-$lang/bem-core-rationale-$lang.html last;
    rewrite ^/articles/bemhtml-rationale/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/bem-core-rationale-$lang/_bem-core-rationale-$lang.$1$2 last;

    rewrite ^/articles/deps-js-syntax/$ /pages-desktop/articles-deps-js-syntax-$lang/articles-deps-js-syntax-$lang.html last;
    rewrite ^/articles/deps-js-syntax/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/articles-deps-js-syntax-$lang/_articles-deps-js-syntax-$lang.$1$2 last;

    rewrite ^/articles/smartcd/$ /pages-desktop/articles-smartcd-$lang/articles-smartcd-$lang.html last;
    rewrite ^/articles/smartcd/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/articles-smartcd-$lang/_articles-smartcd-$lang.$1$2 last;

    rewrite ^/articles/yamapsbem/$ /pages-desktop/articles-yamapsbem-$lang/articles-yamapsbem-$lang.html last;
    rewrite ^/articles/yamapsbem/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/articles-yamapsbem-$lang/_articles-yamapsbem-$lang.$1$2 last;

    # AHTUNG: the firm-card-story block is called article which is bad :(
    rewrite ^/articles/firm-card-story/$ /pages-desktop/articles-article-$lang/articles-article-$lang.html last;
    rewrite ^/articles/firm-card-story/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/articles-article-$lang/_articles-article-$lang.$1$2 last;

    # AHTUNG: img rewrites for firm-card-story are awful!
    rewrite ^/articles/firm-card-story/__images/(.*)$ /content/articles/firm-card-story/docs/article/__images/$1 last;

    # Error page
    #error_page  404 = /pages-desktop/404/404$lang.html;

    # /favicon.ico
    rewrite ^/favicon.ico$ /pages-desktop/favicon.ico last;

    # / => /pages-desktop/index
    rewrite ^/(\?.*)?$ /pages-desktop/index-$lang/index-$lang.html$1 last;
    rewrite ^/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/index-$lang/_index-$lang.$1$2 last;
    rewrite ^/_(?:[\w-]+)\.js(\?.*)?$ /pages-desktop/index-$lang/_index-$lang.$lang.$1$2 last;

    # /page => /pages-desktop/page/page.html
    rewrite ^/([\w-]+)/(\?.*)?$ /pages-desktop/$1-$lang/$1-$lang.html$2 last;

    # /page/blocks/block/image.png, jpg, gif => /pages-desktop/page/blocks/block/image.png, jpg, gif
    rewrite ^/blocks/(.+)/(.+)\.(png|jpg|gif)(\?.*)?$ /pages-desktop/index-$lang/blocks/$1/$2.$3$4 last;
    rewrite ^/([\w-]+)/blocks/(.+)/(.+)\.(png|jpg|gif)(\?.*)?$ /pages-desktop/$1-$lang/blocks/$2/$3.$4$5 last;

    # css, js
    rewrite ^/([\w-]+)/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/$1-$lang/_$1-$lang.$2$3 last;
    rewrite ^/([\w-]+)/_(?:[\w-]+)\.(js)(\?.*)?$ /pages-desktop/$1-$lang/_$1-$lang.$lang.$2$3 last;

    # add final slash to url
    rewrite ^/([^?/.]+)(\?.*)?$ /$1/$2 permanent;
    rewrite ^/([^?]+/[^?/.]+)(\?.*)?$ /$1/$2 permanent;
