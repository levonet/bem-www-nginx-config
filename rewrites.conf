# Поменять урлы в bemmjson + make.js - убрать лишние строки

# Method
rewrite ^/method/$ /bem-method-index-$lang.html last;
rewrite ^/method/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /_bem-method-index-$lang.$1$2 last;
rewrite ^/method/([\w-]+)/$ /bem-method-$1-$lang.html last;
rewrite ^/method/([\w-]+)/_([\w-]+)\.(css|\w+\.css)(\?.*)?$ /_$2.$3$4 last;

# Tools
rewrite ^/tools/$ /tools-index-$lang.html last;
rewrite ^/tools/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /_tools-index-$lang.$1$2 last;

    # Bem tools
    rewrite ^/tools/bem/$ /bem-tools-index-$lang.html last;
    rewrite ^/tools/bem/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /_bem-tools-index-$lang.$1$2 last;
    rewrite ^/tools/bem/([\w-]+)/$ /bem-tools-$1-$lang.html last;
    rewrite ^/tools/bem/([\w-]+)/_([\w-]+)\.(css|\w+\.css)(\?.*)?$ /_$2.$3$4 last;

    # CSSO
    rewrite ^/tools/csso/$ /csso-index-$lang.html last;
    rewrite ^/tools/csso/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /_csso-index-$lang.$1$2 last;
    rewrite ^/tools/csso/([\w-]+)/$ /csso-$1-$lang.html last;
    rewrite ^/tools/csso/([\w-]+)/_([\w-]+)\.(css|\w+\.css)(\?.*)?$ /_$2.$3$4 last;

    # Borschik
    rewrite ^/tools/borschik/$ /borschik-index-$lang.html last;
    rewrite ^/tools/borschik/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /_borschik-index-$lang.$1$2 last;
    rewrite ^/tools/borschik-server/$ /borschik-server-borschik-server-$lang.html last;
    rewrite ^/tools/borschik-server/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /_borschik-server-borschik-server-$lang.$1$2 last;

# blog
rewrite ^/blog/$ /blog-bemup-yac2013-$lang.html last;
rewrite ^/blog/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /_blog-bemup-yac2013-$lang.$1$2 last;

rewrite ^/blog/2013/02/bem-goes-to-india/$ /blog-2013-02-bem-goes-to-india-$lang.html last;
rewrite ^/blog/2013/02/bem-goes-to-india/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /_blog-2013-02-bem-goes-to-india-$lang.$1$2 last;

rewrite ^/blog/2013/02/maintainable-frontend-dev-with-bem/$ /blog-2013-02-maintainable-frontend-dev-with-bem-$lang.html last;
rewrite ^/blog/2013/02/maintainable-frontend-dev-with-bem/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /_blog-2013-02-maintainable-frontend-dev-with-bem-$lang.$1$2 last;

rewrite ^/blog/2013/07/anygrid-bem-notations/$ /blog-anygrid-bem-notations-$lang.html last;
rewrite ^/blog/2013/07/anygrid-bem-notations/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /blog-anygrid-bem-notations-$lang.$1$2 last;

rewrite ^/blog/2013/07/bem-tools-0-5-33/$ /blog-bem-tools-0-5-33-$lang.html last;
rewrite ^/blog/2013/07/bem-tools-0-5-33/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /blog-bem-tools-0-5-33-$lang.$1$2 last;

rewrite ^/blog/2013/07/bem-tools-0-6-4/$ /blog-bem-tools-0-6-4-$lang.html last;
rewrite ^/blog/2013/07/bem-tools-0-6-4/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /blog-bem-tools-0-6-4-$lang.$1$2 last;

rewrite ^/blog/2013/07/bem-cli/$ /blog-bem-cli-$lang.html last;
rewrite ^/blog/2013/07/bem-cli/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /blog-bem-cli-$lang.$1$2 last;

rewrite ^/blog/2013/07/bemup/$ /blog-bemup-$lang.html last;
rewrite ^/blog/2013/07/bemup/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /blog-bemup-$lang.$1$2 last;

rewrite ^/blog/2013/08/bem-components/$ /blog-bem-components-$lang.html last;
rewrite ^/blog/2013/08/bem-components/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /blog-bem-components-$lang.$1$2 last;

rewrite ^/blog/2013/08/bemup-promo/$ /blog-bemup-promo-$lang.html last;
rewrite ^/blog/2013/08/bemup-promo/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /blog-bemup-promo-$lang.$1$2 last;

rewrite ^/blog/2013/08/bemup-talks/$ /blog-bemup-talks-$lang.html last;
rewrite ^/blog/2013/08/bemup-talks/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /blog-bemup-talks-$lang.$1$2 last;

rewrite ^/blog/2013/09/bemup-yac2013/$ /blog-bemup-yac2013-$lang.html last;
rewrite ^/blog/2013/09/bemup-yac2013/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /blog-bemup-yac2013-$lang.$1$2 last;

# Acknowledgement
rewrite ^/pages/acknowledgement/$ /pages-acknowledgement-$lang.html last;
rewrite ^/pages/acknowledgement/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-acknowledgement-$lang.$1$2 last;

# Articles

rewrite ^/articles/$ /articles-index-$lang.html last;
rewrite ^/articles/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /_articles-index-$lang.$1$2 last;

rewrite ^/articles/start-with-project-stub/$ /articles-start-with-project-stub-$lang.html last;
rewrite ^/articles/start-with-project-stub/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /_articles-start-with-project-stub-$lang.$1$2 last;

rewrite ^/articles/yandex-frontend-dev/$ /articles-yandex-frontend-dev-$lang.html last;
rewrite ^/articles/yandex-frontend-dev/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /_articles-yandex-frontend-dev-$lang.$1$2 last;

rewrite ^/articles/borschik/$ /articles-borschik-$lang.html last;
rewrite ^/articles/borschik/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /_articles-borschik-$lang.$1$2 last;

rewrite ^/articles/bem-js-main-terms/$ /articles-bem-js-main-terms-$lang.html last;
rewrite ^/articles/bem-js-main-terms/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /_articles-bem-js-main-terms-$lang.$1$2 last;

rewrite ^/articles/bemhtml-intro/$ /bem-core-intro-$lang.html last;
rewrite ^/articles/bemhtml-intro/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /_bem-core-intro-$lang.$1$2 last;

rewrite ^/articles/bemhtml-reference/$ /bem-core-reference-$lang.html last;
rewrite ^/articles/bemhtml-reference/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /_bem-core-reference-$lang.$1$2 last;

rewrite ^/articles/bemhtml-rationale/$ /bem-core-rationale-$lang.html last;
rewrite ^/articles/bemhtml-rationale/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /_bem-core-rationale-$lang.$1$2 last;

rewrite ^/articles/deps-js-syntax/$ /articles-deps-js-syntax-$lang.html last;
rewrite ^/articles/deps-js-syntax/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /_articles-deps-js-syntax-$lang.$1$2 last;

rewrite ^/articles/smartcd/$ /articles-smartcd-$lang.html last;

rewrite ^/articles/yamapsbem/$ /articles-yamapsbem-$lang.html last;

rewrite ^/articles/firm-card-story/$ /articles-article-$lang.html last;

# Забрать картинки к себе
# AHTUNG: img rewrites for firm-card-story are awful!
rewrite ^/articles/firm-card-story/__images/(.*)$ /content/articles-article-cles/firm-card-story/docs/article/__images/$1 last;

# TODO: Где фавиконка - поправить rules сp в корень
# /favicon.ico
rewrite ^/favicon.ico$ /pages-desktop/favicon.ico last;

# / => /pages-desktop/index
rewrite ^/(\?.*)?$ /index-$lang.html$1 last;
rewrite ^/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /_index-$lang.$1$2 last;

# /page/blocks/block/image.png, jpg, gif => /pages-desktop/page/blocks/block/image.png, jpg, gif
rewrite ^/blocks/(.+)/(.+)\.(png|jpg|gif)(\?.*)?$ /pages-desktop/index-$lang/blocks/$1/$2.$3$4 last;
rewrite ^/([\w-]+)/blocks/(.+)/(.+)\.(png|jpg|gif)(\?.*)?$ /pages-desktop/$1-$lang/blocks/$2/$3.$4$5 last;

# css, js
rewrite ^/([\w-]+)/_(?:[\w-]+)\.(css|\w+\.css)(\?.*)?$ /pages-desktop/$1-$lang/_$1-$lang.$2$3 last;
rewrite ^/([\w-]+)/_(?:[\w-]+)\.(js)(\?.*)?$ /pages-desktop/$1-$lang/_$1-$lang.$lang.$2$3 last;

# add final slash to url
rewrite ^/([^?/.]+)(\?.*)?$ /$1/$2 permanent;
rewrite ^/([^?]+/[^?/.]+)(\?.*)?$ /$1/$2 permanent;
